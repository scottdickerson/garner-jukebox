---
import Layout from '../../../../layouts/Layout.astro'
import { decades } from '../../../../data/imageDescriptions'
import { translatedStrings } from '../../../../data/translations'
import { PhotoDetails } from '../../../../components/PhotoDetails'

const decadeAudioFiles = decades.map(({ decade }) => ({
    decade,
    audio: `/sounds/${decade}.mp3`,
}))

export function getStaticPaths() {
    return Object.keys(translatedStrings).flatMap((lang) =>
        decades.flatMap(({ decade, captions }) =>
            captions?.map((_caption, index) => ({
                params: { decade, photo: index.toString(), lang },
            }))
        )
    )
}
const { decade, photo, lang } = Astro.params ?? {
    decade: 'Decade',
    photo: '1',
    lang: 'en',
}
---

<Layout title={`Decade: ${decade}`}>
    <PhotoDetails
        title={decades.find((data) => data.decade === decade)?.title?.[
            lang as keyof typeof translatedStrings
        ] ?? ''}
        lang={lang}
        decade={decade}
        photo={photo}
        caption={decades.find((data) => data.decade === decade)?.captions?.[
            parseInt(photo) - 1
        ][lang as keyof typeof translatedStrings]}
    />
    <audio
        src={decadeAudioFiles.find((d) => d.decade === decade)?.audio}
        autoplay></audio>
</Layout>
